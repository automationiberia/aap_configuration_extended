---
# tasks file for filetree_create
- block:
    - name: "Check if the controller_api plugin is correctly selected"
      ansible.builtin.assert:
        that:
          - controller_api_plugin is defined
          - controller_api_plugin is match('awx.awx.controller_api') or controller_api_plugin is match('ansible.controller.controller_api')
        fail_msg: "'controller_api_plugin' variable must be defined with one of the following possible values: 'awx.awx.controller_api' or 'ansible.controller.controller_api'"
        quiet: true

    - name: "Check if the required input variables are present"
      ansible.builtin.assert:
        that:
          - input_tag is defined
          - (input_tag | type_debug) == 'list'
        fail_msg: 'A variable called ''input_tag'' of type ''list'' is needed: -e ''{input_tag: [organizations, projects]}'''
        quiet: true

    - name: "Check if the required input values are correct"
      ansible.builtin.assert:
        that:
          - tag_item in valid_tags
        fail_msg: "The valid tags are the following ones: {{ valid_tags | join(', ') }}"
        quiet: true
      loop: "{{ input_tag }}"
      loop_control:
        loop_var: tag_item

  tags:
    - always

- name: "Include Tasks to get all objects of type {{ input_tag }}"
  include_tasks: all.yml
  args:
    apply:
      tags: "{{ input_tag | to_yaml }}"
  tags: "{{ valid_tags }}"
...
